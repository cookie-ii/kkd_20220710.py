# 글로벌 조건 입력하는 곳(어느 곳이든 동일)
# ----------- 전체 조건 -------------
easy_prod = 0.7                 # 1시간 이내 제품
normal_prod = 0.9               # 1~2시간 제품
hard_prod = 0.95                # 2시간 초과
# 킹덤패스
bReward = (121, 207, 16)        # 모두 받기 활성화
pix_pass_reward_exist = (255, 0, 0)

# 건물 내부 색상
pix_wood = (117, 59, 40)        # 나무
pix_jelbean = (4, 239, 237)     # 젤리빈
pix_white = (255, 255, 255)     # 설탕
pix_biscuit = (205, 132, 63)    # 비스킷
pix_berry = (187, 40, 44)       # 젤리베리
pix_milk = (236, 241, 241)      # 우유
pix_cotton = (255, 247, 255)    # 솜
pix_smith = (163, 118, 85)      # 도끼 스미스
pix_jelly = (15, 174, 202)      # 젤리빈 잼 젤리
pix_rollc = (214, 146, 105)     # 솔새 롤케
pix_rollc_d = (237, 197, 122)   # 솔새 롤케 내린 상태
pix_bread = (142, 66, 8)        # 호밀빵 브레드
pix_bread_d = (242, 223, 195)   # 빵집 내린 상태
pix_jampy = (168, 29, 42)       # 젤리스튜 잼파이
pix_jampy_d = (171, 183, 59)    # 젤리스튜 내린 상태
pix_doye = (157, 84, 43)        # 비스킷 화분 - 도예
pix_doye_d = (183, 177, 249)    # 도예 내린 상태
pix_flower = (255, 30, 130)     # 캔디꽃 - flower
pix_flower_d = (211, 136, 227)  # 꽃가게 내린 상태
pix_milky = (213, 229, 234)     # 크림 - milky
pix_latte = (255, 251, 238)     # 젤리빈 라떼 - latte
pix_dolls = (109, 235, 249)     # 쿠션 - dolls
pix_beer = (153, 103, 67)       # 크림루트비어 - beer
pix_muffin = (190, 92, 59)      # 머핀 - muffin
pix_jewel = (143, 99, 63)       # 글레이즈드링 - jewel
pix_magic = (93, 55, 48)        # 마법공방 - magic
pix_icecream = (254, 253, 229)  # 디즈니 아이스크림 트럭
pix_icecream_d = (225, 161, 92) # 아이스크림 내린 상태
pix_status_in = (227, 163, 2)   # 생산건물 내 07.31. 수정
pix_status_in_dark = (113, 81, 1)   # 건물 안이긴 한데 창이 떠있음
pix_status_in_magic_dark = (109, 81, 9)     # 마법공방이고 생산품 보상이 떠있음

# 왕국(건물 밖)
pix_status_out = (12, 193, 252)  # 바탕화면(왕국), 트로피컬도 동일
pix_status_out_window = (6, 97, 124)  # 창이 떠서 어두워짐
pix_status_out_esc = (6, 97, 126)  # 왕국.. ESC나 트로피컬 썬배드로 어두워진..
pix_status_bal_lobby = (175, 131, 0) # 열기구 로비
pix_status_bal_window = (127, 95, 4)  #열기구 창 떠서 어두워짐
pix_status_kdpass = (42, 27, 19) # 킹덤패스
pix_status_warehouse = (55, 64, 105) # 창고 뜸
pix_status_mail = (60, 70, 105)  # 우편함
pix_lackof1 = (243, 233, 223)  # 베이지색
pix_status_not_prod = (0, 124, 176) # 건물 클릭했지만 생산 건물은 아님
pix_status_cookiehouse = (9, 138, 180) # 엥 이게 다 달라?
pix_status_lotto = (255, 208, 2)  # 뽑기, 해변교역소
pix_status_mycookie = (95, 240, 241) #내 쿠키...으... 움직이면 틀어질텐데
pix_status_fountain = (84, 93, 134) # 분수..
pix_stats_kkd_start = (11, 10, 42) # 바탕화면 나갔네
pix_status_trade = (255, 209, 2)  # 해상무역센터 로비
pix_status_wanted = (29, 10, 12)  # 오늘의 현상수배 선택하는 곳
pix_status_fight_comp = (168, 167, 167) # 모험 전투 후
pix_status_fight_comp1 = (121, 98, 74)  # 모험 전투 후1
pix_status1_tropical = (255, 98, 170)  # 트로피칼이다
pix_status1_tropical_windowopen = (127, 49, 85)  # 트로피칼에 메뉴창 떠있다

# 곰젤리열기구
pix_status_bal_what = (85, 63, 0)
pix_status_bal_arrive = (170, 169, 168) # 열기구 보상수령(바닥 글씨 마침표)
pix_status_bal_lobby = (174, 130, 2) # 열기구 로비
pix_status_ballon = (29, 36, 46) # 열기구 날아다니는 중
pix_status_bal_window = (127, 95, 4)  #열기구 창 떠서 어두워짐

# 스샷모드
pix_clicked = (28, 39, 51)      # 클릭해서 어두워짐

# 앵무 엔터 Angmu_Enter
pix_green = (121,207,12)

# 연구소 research_action
pix_research_selected = (58, 73, 109)
pix_green = (121, 207, 12)   # 녹색(가능)
pix_grey = (160, 160, 160)   # 회색(불가능)

# 아레나 Arena_action
pix_medal_normal = (249, 206, 22) # 이건 왜지
pix_medal_normal1 = (249, 205, 21) # 이건 왜지
pix_daejun_selected = (65, 58, 56)
pix_daejun_not_selected = (69, 78, 121)

# 하트 소진 Heart_sojin
pix_adv_dark = (74, 44, 34)  # 스토리모드 어둠모드 확인

# 소원나무 sowon_jjokji_action
pix_upper_void = (46, 30, 50) # 이미지 확인공간 대기상태(아무 생산품도 클릭 안함)
pix_wait = (115, 224, 0) # 갱신하기 후 기다림 오른쪽 연두색>>체크인듯
pix_wait1 = (0, 167, 255) # 갱신하기 후 기다림 왼쪽 파란색막대기둥
pix_wait2 = (112, 222, 0) # 대기중이야..
pix_no_reward = (33, 44, 64) # 일일보상 대기상태

# 그 외, 기타, 차이점, 미사용
pix_stats_kkd_start = (11, 10, 42) # 바탕화면 나갔네
pix_status_arena_lobby = (197, 196, 194) # 아레나 로비화면!
pix_status_boldline_yes = (13, 16, 48)
pix_status_temple = (177, 123, 153) # 찬란한 영웅들의 신전 대기화면, 석상화면 같음
pix_status_temple_dark = (88, 61, 76) # 찬란한 영웅들의 신전 화면 어두워졌을 때(슬롯 확장 잘못누름)

prod_build_num_list = ('몰라요', '나무', '젤리빈', '각설탕', '비스킷', '젤리베리', '우유', '솜', '대장간', '잼가게', '공작소', '빵집', '잼파이', '도예', '꽃가게', '우유 가공소', '라떼', '인형공방', '오크통 쉼터', '퐁 드 파티세리', '살롱 드 주얼리', '마법공방', '아이스크림')
prod_build_prod_max = (0,3,3,3,3,3,3,3,7,5,4,6,6,4,6,3,3,3,3,3,3,14,5)
prod_build_number = (0,3,3,3,3,3,3,11,7,5,6,6,4,6,3,3,3,3,3,3,14,5)
prod_build_now = 0  # 초기값 : 몰라요
# ----------------------------------



def While_True_Condition(account, start_time, max_act_time):  # Ture:정상상태(다음 동작 가능), False:이상상태(다음 동작 안함-최대시간 초과 등)
    now_time = time.time()
    cond_network = pag.locateCenterOnScreen('cond_network.png', confidence = 0.96, region = (440,363+account*540,43,29))
    cond_halted = pag.locateCenterOnScreen('cond_halted.png', confidence=0.85, region = (2,32+account*540,917,505))
    if start_time - now_time > max_act_time:
        End_kkd(account)                            # 쿠킹덤 종료. 15분 안엔 끝나겠지.
        Kingdom_ready(account,'kkd_out')            # 재부팅
        return False
    elif keyboard.is_pressed('end'):
        return False
    elif (cond_network):
        pag.click(random.randint(462-5,462+5),random.randint(377-5,377+5)+account*540)
        time.sleep(0.3)
    elif (cond_halted):
        pag.click(740,310+account*540)
        End_kkd(account)
        Kingdom_ready(account,'kkd_out')            # 재부팅
    else:
        return True

def Building_Num_Check(account):
    start_time = time.time()
    max_act_time = 180
    pix_error_count = 0
    while True:
        if not While_True_Condition(account, start_time, max_act_time):
            return 0
        screen = ImageGrab.grab()
        pix_status = screen.getpixel((605 + (account // 2) * 960,55 + (account % 2) * 540)) # 상단골드
        pix_prod = screen.getpixel((610,140+account*540))   # 생산품 이미지 확인
        in_pos = pag.locateCenterOnScreen('bInPosition.png', confidence=0.8, region=(2 + (account // 2) * 960,32 + (account % 2) * 540,917,505))             # 건물 안
        
        if pix_status == pix_status_in or (in_pos):   # 건물 안 ok
            if pix_prod == pix_wood:
                print('나무!')
                pix_error_count = 0
                return 1
            elif pix_prod == pix_jelbean:
                print('젤리빈!')
                pix_error_count = 0
                return 2
            elif pix_prod == pix_white:
                print('각설탕!')
                pix_error_count = 0
                return 3
            elif pix_prod == pix_biscuit:
                print('비스킷!')
                pix_error_count = 0
                return 4
            elif pix_prod == pix_berry:
                print('젤리베리!')
                pix_error_count = 0
                return 5
            elif pix_prod == pix_milk:
                print('우유!')
                pix_error_count = 0
                return 6
            elif pix_prod == pix_cotton:
                print('smith!')
                pix_error_count = 0
                return 7
            elif pix_prod == pix_smith:
                print('smith!')
                pix_error_count = 0
                return 8
            elif pix_prod == pix_jelly:
                print('jelly!')
                pix_error_count = 0
                return 9
            elif pix_prod == pix_rollc:
                print('rollc!')
                pix_error_count = 0
                return 10
            # elif pix_prod == pix_rollc_d:
            #     print('rollc!')
            #     pix_error_count = 0
            #     return 10
            elif pix_prod == pix_bread:
                print('bread!')
                pix_error_count = 0
                return 11
            # elif pix_prod == pix_bread_d:
            #     print('bread!')
            #     pix_error_count = 0
            #     return 11
            elif pix_prod == pix_jampy:
                print('jampy!')
                pix_error_count = 0
                return 12
            # elif pix_prod == pix_jampy_d:
            #     print('jampy!')
            #     pix_error_count = 0
            #     return 12
            elif pix_prod == pix_doye:
                print('doye!')
                pix_error_count = 0
                return 13
            # elif pix_prod == pix_doye_d:
            #     print('doye!')
            #     pix_error_count = 0
            #     return 13
            elif pix_prod == pix_flower:
                print('flower!')
                pix_error_count = 0
                return 14
            # elif pix_prod == pix_flower_d:
            #     print('flower!')
            #     pix_error_count = 0
            #     return 14
            elif pix_prod == pix_milky:
                print('milky!')
                pix_error_count = 0
                return 15
            elif pix_prod == pix_latte:
                print('latte!')
                pix_error_count = 0
                return 16
            elif pix_prod == pix_dolls:
                print('dolls!')
                pix_error_count = 0
                return 17
            elif pix_prod == pix_beer:
                print('beer!')
                pix_error_count = 0
                return 18
            elif pix_prod == pix_muffin:
                print('muffin!')
                pix_error_count = 0
                return 19
            elif pix_prod == pix_jewel:
                print('jewel!')
                pix_error_count = 0
                return 20
            elif pix_prod == pix_magic:
                print('Magic!')
                pix_error_count = 0
                return 21
            elif pix_prod == pix_icecream:
                print('icecream!')
                pix_error_count = 0
                return 22
            else:
                print(pix_prod)
                print('건물 안에서... 픽셀값 찾게 위로 올림')
                pag.moveTo(610 + (account // 2) * 960,random.randint(140,160) + (account % 2) * 540)
                time.sleep(0.1)
                pag.mouseDown()
                time.sleep(0.1)
                pag.moveTo(610 + (account // 2) * 960,160+350 + (account % 2) * 540,0.3)
                pag.mouseUp()
                time.sleep(2)
                pix_error_count = pix_error_count + 1
                if pix_error_count == 2:
                    return 0
        else:
            print('건물 안이 아니다!')
            Enter_Building(account)

def Building_Moving(account,want_to_go):
    start_time_bn = time.time()
    bDirection_Confirm = False  # 어디로 이동할 지 결정했니
    prod_direction_left = False # 시작은 우측부터..
    while True:
        if not While_True_Condition(account, start_time_bn, 180):
            print('동작 최대시간 초과 or End버튼 누름')
            return
        
        prod_build_now = Building_Num_Check(account)
        if prod_build_now == 0:
            print('왜 못찾는겨!!')
            prod_build_now = Building_Num_Check(account)
        
        print('현재 건물은:',prod_build_num_list[prod_build_now])
        time.sleep(0.5)
        
        # 건물 안, 좌/우 조건 확인 전
        if prod_build_now == want_to_go:
            print('여기!',prod_direction_left)
            # 첫 건물에 찾고, 그 건물 개수가 2개인 경우가 나무밖에 없나?
            return prod_direction_left
        else:
            if bDirection_Confirm:
                Skip_Next(account, prod_direction_left)
            else:   # 어디로 움직일 지 확정 했으면 걍 그쪽으로 쭉-
                Move_Right_Count = want_to_go - prod_build_now # 우측으로 갈 때
                if Move_Right_Count < 0:
                    Move_Right_Count = Move_Right_Count + 22
                print('우로 가려면',Move_Right_Count)
                if Move_Right_Count < 11:  # 우측 가는 게 10번 이하면 우측으로
                    print('우측 이동')
                    prod_direction_left = False
                else:
                    print('좌측 이동')  # 우측 가는 게 11번 이상이면 좌측으로
                    prod_direction_left = True
                bDirection_Confirm = True

def Updown_Confidence(account, updown):
    if updown == 'up':
        pag.moveTo(610 + (account // 2) * 960,530 + (account % 2) * 540)
        pag.mouseDown()
        time.sleep(0.2)
        pag.moveTo(610 + (account // 2) * 960,530 + (account % 2) * 540 - 153*3,2)   # 153인데 20 더 여유줌
        time.sleep(0.5)
        pag.mouseUp()
        time.sleep(1)
    if updown == 'down':
        pag.moveTo(610 + (account // 2) * 960,100 + (account % 2) * 540)
        pag.mouseDown()
        time.sleep(0.2)
        pag.moveTo(610 + (account // 2) * 960,100 + (account % 2) * 540 + 400,2)   # 153인데 20 더 여유줌
        time.sleep(0.5)
        pag.mouseUp()
        time.sleep(1)

    start_time_bn = time.time()
    while True:
        print('정교 위치 체크중...')
        if not While_True_Condition(account, start_time_bn, 20):
            print('동작 최대시간 초과 or End버튼 누름')
            return
        # 두 번째 시계
        time.sleep(0.5)
        prod_clock = pag.locateCenterOnScreen('prod_clock.png',confidence=0.8, region=(554 + (account // 2) * 960,198 + (account % 2) * 540,20,153))
        # y좌표 208이 원래 제일 위. 맨 아랫칸으로 가면 215. 225쯤 되면 맨 아래 짤림
        if (prod_clock):
            print('prod_clock',prod_clock)
            if 216 + (account % 2) * 540 > prod_clock[1] > 200 + (account % 2) * 540:
                print('오우예')
                return
            else:
                pag.moveTo(prod_clock)
                pag.mouseDown()
                time.sleep(0.2)
                pag.moveTo(prod_clock[0],prod_clock[1]-20,1)   # 한 번 움직여보고
                pag.moveTo(prod_clock[0],prod_clock[1],1)   # 두 번 움직여보고
                time.sleep(1)
                prod_clock_new = pag.locateCenterOnScreen('prod_clock.png',confidence=0.8, region=(554 + (account // 2) * 960,198 + (account % 2) * 540,20,153))
                if (prod_clock_new):    # 새 위치 찾아서
                    print('prod_clock_new',prod_clock_new)
                    if 212 + (account % 2) * 540 > prod_clock_new[1] > 204 + (account % 2) * 540:
                        print('오우예')
                        pag.mouseUp()
                        return
                    else:
                        pag.moveTo(prod_clock[0],prod_clock[1] + (208 + (account % 2) * 540 - prod_clock_new[1]),2)   # 현재 마우스 위치에서 목표(y:208까지의 차이값 만큼 빼줌)
                time.sleep(1)
                pag.mouseUp()
        else:
            print('왜 못찾냐 시계를...')
            return

def new_prod_check(account, Active_Line1, Active_Line2, Active_Line3):
    # 3개인 경우 다 체크.
    # How_Many_From_Back = 3이면 다 체크, 2면 2,3번 체크, 1이면 3번만 체크
    prod_clock = pag.locateAllOnScreen('prod_clock.png',confidence=0.85, region=(2,32+account*540,917,505))
    if (prod_clock):
        list_clock = list()
        for p in prod_clock:
            ctr = pag.center(p)
            list_clock.append(ctr)
    else:
        print('시계 3개 못찾음!!!')
        return False
    list_clock = del_duplication_clock(3, list_clock)
    print('list_clock',list_clock)
    list_return = list()
    if Active_Line1:
        list_return.append(numb_new_recog((list_clock[0][0]+48,list_clock[0][1]-113),1))

    if Active_Line2:
        list_return.append(numb_new_recog((list_clock[1][0]+48,list_clock[1][1]-113),1))

    if Active_Line3:
        list_return.append(numb_new_recog((list_clock[2][0]+48,list_clock[2][1]-113),1))
    return list_return

def All_Prod_Num_Check(account):
    # 아.. 픽셀 _d 못쓰겠네.. 올려야 1렙부터 확인이구나
    start_time_bn = time.time()
    for want_to_go in range(8,23):
        if not While_True_Condition(account, start_time_bn, 180):
            print('동작 최대시간 초과 or End버튼 누름')
            return
        Building_Moving(account,want_to_go)     # 원하는 건물로 이동해써
        # its_max_lev = prod_build_prod_max[i]    # 최고렙까지 재고 파악해(열든 안열었든이군..)
        its_list = new_prod_check(account, 1, 1, 1)
        if want_to_go == 8: # 대장간
            Stock_8 = its_list
            Updown_Confidence(account, 'up')
            Stock_8 = Stock_8 + new_prod_check(account, 1, 1, 1)
            Updown_Confidence(account, 'up')
            Stock_8 = Stock_8 + new_prod_check(account, 1, 0, 0)
        if want_to_go == 9: # 잼가게
            Stock_9 = its_list
            Updown_Confidence(account, 'up')
            Stock_9 = Stock_9 + new_prod_check(account, 0, 1, 1)
        if want_to_go == 10: # 공작소
            Stock_10 = its_list
            Updown_Confidence(account, 'up')
            Stock_10 = Stock_10 + new_prod_check(account, 0, 0, 1)
        if want_to_go == 11: # 빵집
            Stock_11 = its_list
            Updown_Confidence(account, 'up')
            Stock_11 = Stock_11 + new_prod_check(account, 1, 1, 1)
        if want_to_go == 12: # 레스토랑
            Stock_12 = its_list
            Updown_Confidence(account, 'up')
            Stock_12 = new_prod_check(account, 1, 1, 1)
        if want_to_go == 13: # 도예
            Stock_13 = its_list
            Updown_Confidence(account, 'up')
            Stock_13 = Stock_13 + new_prod_check(account, 0, 0, 1)
        if want_to_go == 14: # 꽃가게
            Stock_14 = its_list
            Updown_Confidence(account, 'up')
            Stock_14 = Stock_14 + new_prod_check(account, 1, 1, 1)
        if want_to_go == 15: # 우유 가공소
            Stock_15 = its_list
        if want_to_go == 16: # 카페라떼
            Stock_16 = its_list
        if want_to_go == 17: # 인형
            Stock_17 = its_list
        if want_to_go == 18: # 비어
            Stock_18 = its_list
        if want_to_go == 19: # 머핀
            Stock_19 = its_list
        if want_to_go == 20: # 주얼리
            Stock_20 = its_list
        if want_to_go == 21: # 매직;;; 다 해야하나
            Stock_21 = its_list
            Updown_Confidence(account, 'up')
            Stock_21 = Stock_21 + new_prod_check(account, 1, 1, 1)   # 4,5,6
            Updown_Confidence(account, 'up')
            Stock_21 = Stock_21 + new_prod_check(account, 1, 1, 1)   # 7,8,9
            Updown_Confidence(account, 'up')
            Stock_21 = Stock_21 + new_prod_check(account, 1, 1, 1)   # 10,11,12
            Updown_Confidence(account, 'up')
            Stock_21 = Stock_21 + new_prod_check(account, 0, 1, 1)   # 13,14
        if want_to_go == 22: # 아스크림
            Stock_22 = its_list
            Updown_Confidence(account, 'up')
            Stock_22 = Stock_22 + new_prod_check(account, 0, 1, 1)
        
    for i in range(8,23):
        Stock_List = eval('Stock_'+str(i))
        print('%s 건물 재고 리스트는 %s 입니다.'%(prod_build_num_list[i], Stock_List))

    return

# check_start_time = time.time()
# All_Prod_Num_Check(0)
# check_end_time = time.time()
# print('재고 파악 시간 = ', check_end_time - check_start_time)


# 디즈니 이벤틋... 좀 쉬자 재고없다
bLineEnd_1 = False
bLineEnd_2 = False
bLineEnd_3 = False
iHowMany = 0
tStart_Disney = time.time()
while True:
    tNow_Disney = time.time()
    if tNow_Disney - tStart_Disney > 120:
        print('제한 시간 초과!')
        Kingdom_ready(account, 'kkd_out')
        break
    if keyboard.is_pressed('end'):
        print('end 누름')
        break

    cond_event_butak = pag.locateCenterOnScreen('cond_event_butak.png', confidence=0.85, region=(2 + (account // 2) * 960, 32 + (account % 2) * 540, 700, 540))  # 특별한 '부탁' 인지 확인
    if not (cond_event_butak):
        cond_kkd_out = pag.locateCenterOnScreen('cond_kkd_out.png', confidence=0.85, region=(825 + (account // 2) * 960,490 + (account % 2) * 540,45,40))    # 쿠키왕국
        if (cond_kkd_out):  # 왕국이면... 조건 추가..를 해야하남
            pag.click(45+random.randint(-5,5) + (account // 2) * 960,200+random.randint(-5,5) + (account % 2) * 540)    # 이벤트 아이콘 클릭
            time.sleep(1)
        else:   # 왕국 아니면
            cond_event_in = pag.locateCenterOnScreen('cond_event_in.png', confidence=0.95, region=(13 + (account // 2) * 960, 40 + (account % 2) * 540, 70, 30))    # 이벤트 내부?
            if (cond_event_in):
                cond_event_up = pag.locateCenterOnScreen('cond_event_up.png', confidence=0.95, region=(2 + (account // 2) * 960, 32 + (account % 2) * 540, 700, 540))    # 이벤트 내부인데 부탁이 없다?
                if not (cond_event_up):
                    pag.moveTo(90+random.randint(-5,5) + (account // 2) * 960,140+random.randint(-5,5) + (account % 2) * 540)
                    pag.drag(0,350,2)       # 좌상에서 좌하로 350 이동
                    time.sleep(1)
                else:
                    pag.click(85+random.randint(-5,5) + (account // 2) * 960,410+random.randint(-5,5) + (account % 2) * 540)    # 좌상 끌어올렸으면 해당 이벤트 클릭
                    time.sleep(1)
            else:
                Kingdom_ready(account, 'kkd_out')
    else:
        pix_refresh = (243, 90, 28)		    # 새로고침 버튼(눌렸음)
        pix_can_give = (97, 211, 0)		    # 줄 수 있는 녹색 체크
        pix_cannot_give = (154, 154, 154)	# 줄 수 없는 회색 체크
        pix_refresh = (191, 175, 143)	    # _1 새로고침(어두워짐)
        pix_purple = (113, 88, 146) 	    # _2, _3 보라색
        pix_not_refresh = (255, 233, 191)	# _1 열려있음(밝음)
        
        for i in range(3):
            screen = ImageGrab.grab()
            # 상단
            pix_1_1 = screen.getpixel((330+228*i + (account // 2) * 960,225 + (account % 2) * 540))
            # 새로고침
            pix_1_2 = screen.getpixel((280+228*i + (account // 2) * 960,430 + (account % 2) * 540))
            # 체크박스
            pix_1_3 = screen.getpixel((390+228*i + (account // 2) * 960,430 + (account % 2) * 540))
            if pix_1_3 == pix_can_give: # 건넬 수 있고 다야나 태엽 있으면 건넴
                disney_star = pag.locateCenterOnScreen('disney_star.png', confidence=0.85, region=(215+228*i,465+account*540,205,40))
                disney_dia = pag.locateCenterOnScreen('disney_dia.png', confidence=0.85, region=(215+228*i,465+account*540,205,40))
                disney_quick = pag.locateCenterOnScreen('disney_dia.png', confidence=0.85, region=(215+228*i,465+account*540,205,40))
                if (disney_star) or (disney_dia) or (disney_quick):
                    pag.click(390+228*i+random.randint(-5,5) + (account // 2) * 960,430+random.randint(-5,5) + (account % 2) * 540)
                    iHowMany = iHowMany + 1
                    time.sleep(1)
                else:   # 줄만한 거 아녀도 새로고침.. 물론.. 잘 주면 토핑까지 있겠지만
                    pag.click(280+228*i+random.randint(-5,5) + (account // 2) * 960,430+random.randint(-5,5) + (account % 2) * 540)
                    time.sleep(1)
            elif pix_1_3 == pix_cannot_give:    # 건넬 수 없으면 새로고침
                pag.click(280+228*i+random.randint(-5,5) + (account // 2) * 960,430+random.randint(-5,5) + (account % 2) * 540)
                time.sleep(1)
            else:   # 둘 다 아니면 상단 체크
                if pix_1_1 == pix_refresh:
                    print('%s번 새로고침중...'%(i+1))
                    if i == 0:
                        bLineEnd_1 = True
                    if i == 1:
                        bLineEnd_2 = True
                    if i == 2:
                        bLineEnd_3 = True
                else:
                    pag.click(330+228*i + (account // 2) * 960,225 + (account % 2) * 540) # 정확해야 해서 랜덤함수 뺌..
                    time.sleep(1)
        # if iHowMany >= 3:
        #     print('%s번 돌렸다!' % (iHowMany))
        #     pag.click(892 + (account // 2) * 960, 54 + (account % 2) * 540)
        #     time.sleep(2)
        #     Kingdom_ready(account, 'kkd_out')
        #     break
        if bLineEnd_1 and bLineEnd_2 and bLineEnd_3:
            print('다 새로고침 상태.. %s번 돌림'%(iHowMany))
            pag.click(892 + (account // 2) * 960,54 + (account % 2) * 540)
            time.sleep(4)
            Kingdom_ready(account, 'kkd_out')
            break
    time.sleep(0.5)